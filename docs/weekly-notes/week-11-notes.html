<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.24">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2025-11-17">

<title>Week 11 Notes – Joshua Rigsby - MUSA 5080 Portfolio</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dc55a5b9e770e841cd82e46aadbfb9b0.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-5b4ad623e5705c0698d39aec6f10cf02.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Joshua Rigsby - MUSA 5080 Portfolio</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-weekly-notes" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Weekly Notes</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-weekly-notes">    
        <li>
    <a class="dropdown-item" href="../weekly-notes/week-01-notes.html">
 <span class="dropdown-text">Week 1 Notes</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../weekly-notes/week-02-notes.html">
 <span class="dropdown-text">Week 2 Notes</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../weekly-notes/week-03-notes.html">
 <span class="dropdown-text">Week 3 Notes</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../weekly-notes/week-04-notes.html">
 <span class="dropdown-text">Week 4 Notes</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../weekly-notes/week-05-notes.html">
 <span class="dropdown-text">Week 5 Notes</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../weekly-notes/week-06-notes.html">
 <span class="dropdown-text">Week 6 Notes</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../weekly-notes/week-07-notes.html">
 <span class="dropdown-text">Week 7 Notes</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../weekly-notes/week-09-notes.html">
 <span class="dropdown-text">Week 9 Notes</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../weekly-notes/week-10-notes.html">
 <span class="dropdown-text">Week 10 Notes</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../weekly-notes/week-11-notes.html">
 <span class="dropdown-text">Week 11 Notes</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../weekly-notes/week-12-notes.html">
 <span class="dropdown-text">Week 12 Notes</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-labs" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Labs</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-labs">    
        <li>
    <a class="dropdown-item" href="../labs/lab0/lab0_template.html">
 <span class="dropdown-text">Lab 0</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-assignments" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Assignments</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-assignments">    
        <li>
    <a class="dropdown-item" href="../labs/lab1/assignment1_template.html">
 <span class="dropdown-text">Assignment 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../labs/lab2/Rigsby_Joshua_Assignment2.html">
 <span class="dropdown-text">Assignment 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../labs/lab3_midterm/Midterm_2025_Slides.html">
 <span class="dropdown-text">Midterm Slides</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../labs/lab3_midterm/Midterm_2025_Technical_Appendix.html">
 <span class="dropdown-text">Midterm Technical Appendix</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../labs/lab4/Actual Assignment 4 copy.html">
 <span class="dropdown-text">Assignmnet 4</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#key-concepts-learned" id="toc-key-concepts-learned" class="nav-link active" data-scroll-target="#key-concepts-learned">Key Concepts Learned</a></li>
  <li><a href="#coding-techniques" id="toc-coding-techniques" class="nav-link" data-scroll-target="#coding-techniques">Coding Techniques</a></li>
  <li><a href="#panel-data" id="toc-panel-data" class="nav-link" data-scroll-target="#panel-data">Panel Data</a></li>
  <li><a href="#cross-sectional-one-row-per-station" id="toc-cross-sectional-one-row-per-station" class="nav-link" data-scroll-target="#cross-sectional-one-row-per-station">Cross-sectional: One row per station</a></li>
  <li><a href="#panel-one-row-per-station-hour" id="toc-panel-one-row-per-station-hour" class="nav-link" data-scroll-target="#panel-one-row-per-station-hour">Panel: One row per station-hour</a></li>
  <li><a href="#time-binning" id="toc-time-binning" class="nav-link" data-scroll-target="#time-binning">Time binning</a></li>
  <li><a href="#extracting-time-features" id="toc-extracting-time-features" class="nav-link" data-scroll-target="#extracting-time-features">Extracting Time Features</a></li>
  <li><a href="#temporal-lags" id="toc-temporal-lags" class="nav-link" data-scroll-target="#temporal-lags">Temporal Lags</a></li>
  <li><a href="#creating-lag-variables" id="toc-creating-lag-variables" class="nav-link" data-scroll-target="#creating-lag-variables">Creating Lag Variables</a></li>
  <li><a href="#create-every-possible-station-hour-combination" id="toc-create-every-possible-station-hour-combination" class="nav-link" data-scroll-target="#create-every-possible-station-hour-combination">Create every possible station-hour combination</a></li>
  <li><a href="#join-to-actual-trip-counts" id="toc-join-to-actual-trip-counts" class="nav-link" data-scroll-target="#join-to-actual-trip-counts">Join to actual trip counts</a></li>
  <li><a href="#joining-station-attributes" id="toc-joining-station-attributes" class="nav-link" data-scroll-target="#joining-station-attributes">Joining Station Attributes</a></li>
  <li><a href="#join-to-panel" id="toc-join-to-panel" class="nav-link" data-scroll-target="#join-to-panel">Join to panel</a></li>
  <li><a href="#adding-time-varying-features" id="toc-adding-time-varying-features" class="nav-link" data-scroll-target="#adding-time-varying-features">Adding Time-Varying Features</a></li>
  <li><a href="#create-time-features" id="toc-create-time-features" class="nav-link" data-scroll-target="#create-time-features">Create time features</a></li>
  <li><a href="#temporal-validation" id="toc-temporal-validation" class="nav-link" data-scroll-target="#temporal-validation">Temporal Validation</a></li>
  <li><a href="#test-on-weeks-3-4" id="toc-test-on-weeks-3-4" class="nav-link" data-scroll-target="#test-on-weeks-3-4">Test on Weeks 3-4</a></li>
  <li><a href="#temporal-traintest-split" id="toc-temporal-traintest-split" class="nav-link" data-scroll-target="#temporal-traintest-split">Temporal Train/Test Split</a></li>
  <li><a href="#split-by-time-week-of-year" id="toc-split-by-time-week-of-year" class="nav-link" data-scroll-target="#split-by-time-week-of-year">Split by time (week of year)</a></li>
  <li><a href="#fit-models-on-training-data-only" id="toc-fit-models-on-training-data-only" class="nav-link" data-scroll-target="#fit-models-on-training-data-only">Fit models on training data only</a></li>
  <li><a href="#evaluate-on-test-data" id="toc-evaluate-on-test-data" class="nav-link" data-scroll-target="#evaluate-on-test-data">Evaluate on test data</a></li>
  <li><a href="#questions-challenges" id="toc-questions-challenges" class="nav-link" data-scroll-target="#questions-challenges">Questions &amp; Challenges</a></li>
  <li><a href="#connections-to-policy" id="toc-connections-to-policy" class="nav-link" data-scroll-target="#connections-to-policy">Connections to Policy</a></li>
  <li><a href="#reflection" id="toc-reflection" class="nav-link" data-scroll-target="#reflection">Reflection</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Week 11 Notes</h1>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">November 17, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="key-concepts-learned" class="level2">
<h2 class="anchored" data-anchor-id="key-concepts-learned">Key Concepts Learned</h2>
<ul>
<li>Panel data: Same stations observed over time</li>
<li>Temporal features: What happened last hour?</li>
<li>Space-time interaction: Different patterns by location AND time</li>
</ul>
</section>
<section id="coding-techniques" class="level2">
<h2 class="anchored" data-anchor-id="coding-techniques">Coding Techniques</h2>
</section>
<section id="panel-data" class="level2">
<h2 class="anchored" data-anchor-id="panel-data">Panel Data</h2>
<p>Definition: Data that follows the same units over multiple time periods Bike example, station ID for hour 0 1 2 3 etc. Cross-sectional data: • Each row = one observation • House prices in 2024 • One snapshot in time Panel data: • Each row = unit × time period • Station × hour combinations • Repeated observations</p>
</section>
<section id="cross-sectional-one-row-per-station" class="level2">
<h2 class="anchored" data-anchor-id="cross-sectional-one-row-per-station">Cross-sectional: One row per station</h2>
<p>Station_A, May_2018, 4,250_total_trips Station_B, May_2018, 2,100_total_trips</p>
</section>
<section id="panel-one-row-per-station-hour" class="level2">
<h2 class="anchored" data-anchor-id="panel-one-row-per-station-hour">Panel: One row per station-hour</h2>
<p>Station_A, May_1_08:00, 12_trips Station_A, May_1_09:00, 15_trips Station_A, May_1_10:00, 8_trips Station_B, May_1_08:00, 5_trips Station_B, May_1_09:00, 7_trips</p>
</section>
<section id="time-binning" class="level2">
<h2 class="anchored" data-anchor-id="time-binning">Time binning</h2>
<p>Hourly binning: ## All trips between 8:00-8:59 AM → “08:00” bin dat &lt;- dat %&gt;% mutate(interval60 = floor_date(ymd_hms(start_time), unit = “hour”)) Result: • Trip at 8:05 AM → 08:00 bin • Trip at 8:23 AM → 08:00 bin • Trip at 9:07 AM → 09:00 bin</p>
</section>
<section id="extracting-time-features" class="level2">
<h2 class="anchored" data-anchor-id="extracting-time-features">Extracting Time Features</h2>
<p>dat &lt;- dat %&gt;% mutate( interval60 = floor_date(ymd_hms(start_time), unit = “hour”), week = week(interval60), # Week of year (1-52) dotw = wday(interval60, label=TRUE), # Day of week (Mon, Tue, …) hour = hour(interval60) # Hour of day (0-23) )</p>
<p>These become predictors: • Rush hour indicator: hour %in% c(7,8,9, 17,18,19) • Weekend indicator: dotw %in% c(“Sat”, “Sun”) • Holiday effects: Memorial Day weekend</p>
</section>
<section id="temporal-lags" class="level2">
<h2 class="anchored" data-anchor-id="temporal-lags">Temporal Lags</h2>
<p>Temporal features (This week): • Demand 1 hour ago • Demand 2 hours ago • Demand yesterday (24 hours ago)</p>
</section>
<section id="creating-lag-variables" class="level2">
<h2 class="anchored" data-anchor-id="creating-lag-variables">Creating Lag Variables</h2>
<p>study.panel &lt;- study.panel %&gt;% arrange(from_station_id, interval60) %&gt;% # Sort by station, then time group_by(from_station_id) %&gt;% mutate( lag1Hour = lag(Trip_Count, 1), # Previous hour lag2Hours = lag(Trip_Count, 2), # 2 hours ago lag3Hours = lag(Trip_Count, 3), # 3 hours ago lag12Hours = lag(Trip_Count, 12), # 12 hours ago lag1day = lag(Trip_Count, 24) # Yesterday same time ) %&gt;% ungroup(</p>
<p>expand.grid()</p>
</section>
<section id="create-every-possible-station-hour-combination" class="level2">
<h2 class="anchored" data-anchor-id="create-every-possible-station-hour-combination">Create every possible station-hour combination</h2>
<p>study.panel &lt;- expand.grid( interval60 = unique(dat_census<span class="math inline">\(interval60),
  from_station_id = unique(dat_census\)</span>from_station_id) )</p>
</section>
<section id="join-to-actual-trip-counts" class="level2">
<h2 class="anchored" data-anchor-id="join-to-actual-trip-counts">Join to actual trip counts</h2>
<p>study.panel &lt;- study.panel %&gt;% left_join( dat_census %&gt;% group_by(interval60, from_station_id) %&gt;% summarize(Trip_Count = n()), by = c(“interval60”, “from_station_id”) ) %&gt;% mutate(Trip_Count = replace_na(Trip_Count, 0)) # Fill missing with 0 Now every station-hour exists, even if Trip_Count = 0</p>
</section>
<section id="joining-station-attributes" class="level2">
<h2 class="anchored" data-anchor-id="joining-station-attributes">Joining Station Attributes</h2>
<p>Each station has fixed characteristics: ## Station location, demographics from census station_data &lt;- dat_census %&gt;% group_by(from_station_id) %&gt;% summarize( from_latitude = first(from_latitude), from_longitude = first(from_longitude), Med_Inc = first(Med_Inc), Percent_White = first(Percent_White), # … other demographics )</p>
</section>
<section id="join-to-panel" class="level2">
<h2 class="anchored" data-anchor-id="join-to-panel">Join to panel</h2>
<p>study.panel &lt;- study.panel %&gt;% left_join(station_data, by = “from_station_id”)</p>
</section>
<section id="adding-time-varying-features" class="level2">
<h2 class="anchored" data-anchor-id="adding-time-varying-features">Adding Time-Varying Features</h2>
<p>Some features change over time: ## Weather changes hourly weather &lt;- weather_data %&gt;% select(interval60, Temperature, Precipitation)</p>
<p>study.panel &lt;- study.panel %&gt;% left_join(weather, by = “interval60”)</p>
</section>
<section id="create-time-features" class="level2">
<h2 class="anchored" data-anchor-id="create-time-features">Create time features</h2>
<p>study.panel &lt;- study.panel %&gt;% mutate( week = week(interval60), dotw = wday(interval60, label = TRUE), hour = hour(interval60), weekend = ifelse(dotw %in% c(“Sat”, “Sun”), 1, 0) )</p>
</section>
<section id="temporal-validation" class="level2">
<h2 class="anchored" data-anchor-id="temporal-validation">Temporal Validation</h2>
<p>CORRECT approach: ## Train on Weeks 1-2 train &lt;- data %&gt;% filter(week &lt; 19)</p>
</section>
<section id="test-on-weeks-3-4" class="level2">
<h2 class="anchored" data-anchor-id="test-on-weeks-3-4">Test on Weeks 3-4</h2>
<p>test &lt;- data %&gt;% filter(week &gt;= 19) This is predicting the future using the past!</p>
</section>
<section id="temporal-traintest-split" class="level2">
<h2 class="anchored" data-anchor-id="temporal-traintest-split">Temporal Train/Test Split</h2>
</section>
<section id="split-by-time-week-of-year" class="level2">
<h2 class="anchored" data-anchor-id="split-by-time-week-of-year">Split by time (week of year)</h2>
<p>train &lt;- study.panel %&gt;% filter(week &lt; 19) # Weeks 1-2 of May (early period)</p>
<p>test &lt;- study.panel %&gt;% filter(week &gt;= 19) # Weeks 3-4 of May (later period)</p>
</section>
<section id="fit-models-on-training-data-only" class="level2">
<h2 class="anchored" data-anchor-id="fit-models-on-training-data-only">Fit models on training data only</h2>
<p>model &lt;- lm(Trip_Count ~ lag1Hour + lag1day + Temperature + weekend, data = train)</p>
</section>
<section id="evaluate-on-test-data" class="level2">
<h2 class="anchored" data-anchor-id="evaluate-on-test-data">Evaluate on test data</h2>
<p>predictions &lt;- predict(model, newdata = test)</p>
</section>
<section id="questions-challenges" class="level2">
<h2 class="anchored" data-anchor-id="questions-challenges">Questions &amp; Challenges</h2>
<p>Which temporal lags actually matter?</p>
<p>Including multiple lags (1 hour, 2 hours, 12 hours, 24 hours) raises questions about redundancy and multicollinearity. Many lagged variables are highly correlated with each other, can this inflate standard errors and make coefficients unstable?</p>
<p>How do we separate time effects from station effects?</p>
</section>
<section id="connections-to-policy" class="level2">
<h2 class="anchored" data-anchor-id="connections-to-policy">Connections to Policy</h2>
<p>Panel data models directly support operational policy decisions because they align with how public systems actually function over time. For bike share systems, demand is not static—it evolves hourly, daily, and seasonally. Policies about bike rebalancing, staffing, and infrastructure placement must therefore anticipate future demand rather than explain past usage. Lagged demand variables translate into predictive policy tools. If demand one hour ago strongly predicts current demand, operators can proactively reposition bikes before shortages occur. Weather variables and weekend indicators further enable policy adjustments that reflect real-time conditions, such as deploying additional resources during warm weekend afternoons or reducing supply during inclement weather. Integrating station-level demographics introduces an equity dimension. Policies guided by panel models must consider whether prediction errors systematically differ across neighborhoods or income levels, as misallocation of bikes could encourage access disparities rather than reduce them.</p>
</section>
<section id="reflection" class="level2">
<h2 class="anchored" data-anchor-id="reflection">Reflection</h2>
<p>Unlike cross-sectional analyses, panel models require careful attention to time ordering,and dependency structure. Creating temporal lags clarified how much behavior is driven by past patterns. The fact that recent demand is often the strongest predictor of current demand highlights the importance of short-term prediction in transportation systems.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>